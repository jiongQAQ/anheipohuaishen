# 自动化任务管理工具

一个基于PyQt5的自动化任务管理工具，支持软件启动、窗口控制、坐标点击、账号池管理等功能。

## 🚀 快速开始

### 方法一：使用自动化脚本（推荐）

1. **环境检查**：
   ```bash
   双击运行 check_environment.bat
   ```
   检查Python环境和依赖包是否完整

2. **安装依赖**（如果需要）：
   ```bash
   双击运行 install_dependencies.bat
   ```
   自动安装所有必要的依赖包

3. **启动程序**：
   ```bash
   双击运行 start.bat
   ```
   自动检查环境并启动程序

### 方法二：手动安装

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **启动程序**：
   ```bash
   python main.py
   ```

## 📁 脚本文件说明

| 脚本文件 | 功能说明 |
|---------|---------|
| `start.bat` | 主启动脚本，自动检测Python、检查环境、安装依赖并启动程序 |
| `install_dependencies.bat` | 专门的依赖安装脚本，详细的安装过程和验证 |
| `check_environment.bat` | 环境检查工具，检查Python、依赖包和项目文件 |
| `test_python_detection.bat` | Python检测测试工具，帮助诊断Python安装问题 |

## 🔧 最新修复 (v1.1.0)

### 启动脚本优化

1. **智能Python检测**：
   - 自动检测系统PATH中的Python
   - 扫描常见Python安装路径
   - 支持多种Python版本（3.10-3.13）
   - 无需手动配置Python路径

2. **智能依赖检查**：
   - 逐个检查依赖包安装状态
   - 提供详细的安装指导

3. **自动依赖安装**：
   - 发现缺失依赖时询问是否安装
   - 支持一键安装所有依赖
   - 安装后自动验证

4. **完善的错误处理**：
   - 详细的错误信息和解决建议
   - 支持国内镜像源安装
   - 程序退出状态检查

### 鼠标移动和点击问题修复

参考成熟的自动化代码实现，对鼠标移动和点击功能进行了重大优化：

1. **快速移动**: 使用 `duration=0.1` 进行快速移动，替代复杂的轨迹移动
2. **简单点击**: 直接使用 `pyautogui.click()` 替代复杂的自然点击
3. **可靠等待**: 移动后等待 `0.1` 秒确保移动完成
4. **绝对坐标**: 直接使用屏幕绝对坐标，避免坐标转换问题

### 文本输入优化

1. **剪贴板输入**: 使用剪贴板方式输入文本，避免输入法问题
2. **全选覆盖**: 先全选再粘贴，确保文本正确替换
3. **备用方案**: 如果剪贴板失败，自动降级到直接输入

### 坐标记录改进

1. **简化逻辑**: 直接记录屏幕绝对坐标
2. **错误处理**: 增强异常捕获和错误处理
3. **测试功能**: 添加坐标测试按钮，方便验证

## ✨ 主要功能

- 🖥️ **软件启动和窗口控制**: 自动启动软件A并居中显示
- 📍 **坐标记录和点击**: 使用Ctrl+3记录绝对坐标，支持5个点击位置
- 🔐 **账号池管理**: Redis账号池，支持多账号轮换使用
- 👀 **进程监控**: 监控软件B运行状态，自动重试机制
- 🔄 **任务循环**: 完整的自动化工作流程

## 📋 使用流程

### 基础配置
1. 设置软件A路径（默认: `D:/5.12 法师最新版/VCHelper.vmp.exe`）
2. 设置软件B进程名（默认: `Diablo IV.exe`）
3. 配置Redis连接信息

### 坐标设置
1. 按 **Ctrl+3** 记录5个坐标点
2. 第2个坐标: 用户名输入框
3. 第3个坐标: 密码输入框
4. 第4、5个坐标: 其他按钮
5. 使用"测试坐标点击"验证

### 账号管理
1. 添加账号到Redis账号池
2. 查看账号状态（空闲/占用）
3. 系统自动获取空闲账号使用

### 任务执行
1. 点击"开始任务"
2. 系统自动执行完整流程：
   - 获取空闲账号
   - 启动软件A并居中
   - 按坐标依次点击（输入用户名密码）
   - 监控软件B启动
   - 持续监控直到软件B退出
   - 重新循环

## 🔧 技术特点

### 鼠标控制
- 快速移动: `pyautogui.moveTo(x, y, duration=0.1)`
- 简单点击: `pyautogui.click()`
- 绝对坐标: 直接使用屏幕坐标

### 文本输入
- 剪贴板方式: 避免输入法干扰
- 全选覆盖: 确保文本正确替换
- 备用方案: 多种输入方式保证成功率

### 窗口控制
- 5种激活策略: 确保窗口正确激活
- 强制居中: 自动调整窗口位置
- 进程查找: 多种方法查找目标窗口

## 📁 项目结构

```
automation_tool/
├── main.py                      # 主程序（PyQt5界面）
├── click_sequence.py            # 点击序列执行器
├── window_controller.py         # 窗口控制器
├── account_manager.py           # Redis账号池管理
├── process_monitor.py           # 进程监控器
├── coordinate_recorder.py       # 坐标记录器
├── requirements.txt             # 依赖包列表
├── start.bat                    # 主启动脚本（智能Python检测）
├── install_dependencies.bat     # 依赖安装脚本（智能Python检测）
├── check_environment.bat        # 环境检查脚本（智能Python检测）
├── test_python_detection.bat    # Python检测测试脚本
├── test_mouse_fix.py           # 鼠标功能测试脚本
├── test_coordinate_system.py   # 坐标系统测试脚本
└── README.md                   # 说明文档
```

## 🐛 故障排除

### 环境问题
1. **运行 `test_python_detection.bat`** 测试Python检测
2. **运行 `check_environment.bat`** 检查环境
3. **运行 `install_dependencies.bat`** 安装依赖
4. **Python路径问题** 现已自动检测，无需手动配置

### 鼠标不移动
- 检查pyautogui是否正确安装
- 确认FAILSAFE设置为False
- 运行 `test_mouse_fix.py` 测试基本功能

### 坐标点击不准确
- 使用"测试坐标点击"功能验证
- 重新记录坐标（Ctrl+3）
- 确认使用绝对坐标模式

### 文本输入失败
- 检查pyperclip是否安装
- 确认剪贴板功能正常
- 系统会自动降级到备用输入方式

### 依赖安装失败
- 检查网络连接
- 尝试使用国内镜像源：
  ```bash
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
  ```
- 手动安装单个包进行排查

## 📝 更新日志

### v1.1.0 (2024-01-XX)
- 🔧 **重大修复**: 鼠标移动和点击功能
- 📍 **坐标系统优化**: 直接使用绝对坐标
- 🎯 **用户体验改进**: 详细日志和测试功能
- 🚀 **启动脚本优化**: 自动依赖检查和安装

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 基础功能实现

## 📞 技术支持

如遇问题，请按以下顺序排查：
1. 运行 `test_python_detection.bat` 测试Python检测
2. 运行 `check_environment.bat` 检查环境
3. 运行 `install_dependencies.bat` 安装依赖
4. 查看日志文件获取详细错误信息
5. 运行测试脚本验证基本功能 